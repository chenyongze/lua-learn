---
--- Generated by dotalk.cn
--- Created by yongze.chen
--- DateTime: 2018/9/23 下午11:48
---

--连接redis
local redis = require "resty.redis"
local cache = redis.new()
cache:set_timeout(60000)

local ok, err = cache.connect(cache, 'xxxxx', 7379)
if not ok then
    ngx.say("failed to connect:", err)
    return
end

local red, err = cache:auth("xxxx")
if not red then
    ngx.say("failed to authenticate: ", err)
    return
end

local local_ip = ngx.req.get_headers()["X-Real-IP"]
if local_ip == nil then
    local_ip = ngx.req.get_headers()["x_forwarded_for"]
end

if local_ip == nil then
    local_ip = ngx.var.remote_addr
end

ngx.say("local_ip is : ", local_ip)
keys = cache:hget("xinxi:hash:25014")
ngx.say(keys,"<br/>")


local intercept = cache:get(local_ip)
if intercept == local_ip then
    --ngx.exec("@client2")
    return
end

--ngx.exec("@client1")

local ok, err = cache:close()

if not ok then
    ngx.say("failed to close:", err)
    return
end